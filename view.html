<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Academic Notes</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="stylesheet" href="styles.css">
	
	<!-- Marked (Markdown parser) -->
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	
	<!-- MathJax -->
	<script>
		window.MathJax = {
			tex: {
				inlineMath: [
					['$', '$'],
					['\\(', '\\)']
				],
				displayMath: [
					['$$', '$$']
				]
			}
		};
	</script>
	<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
</head>

<body>
	<header>
		<h1 id="title">Academic Notes</h1>
		<p id="subtitle">Markdown + MathJax</p>
	</header>
	
	<div class="container">
		<aside>
			<h3>Contents</h3>
			<ul id="toc"></ul>
		</aside>
		
		<main id="content">
			<p>Loading notesâ€¦</p>
		</main>
	</div>
	
	<footer>
		<p>Rendered dynamically</p>
	</footer>
	
	<script>
		const params = new URLSearchParams(window.location.search);
		const src = params.get("src");
		
		const contentEl = document.getElementById("content");
		const tocEl = document.getElementById("toc");
		
		if (!src) {
			contentEl.innerHTML = "<p>No markdown file specified.</p>";
			throw new Error("Missing src parameter");
		}
		
		fetch(src)
			.then(res => {
				if (!res.ok) throw new Error("Failed to load markdown");
				return res.text();
			})
			.then(md => {
				// Convert markdown to HTML
				const html = marked.parse(md);
				contentEl.innerHTML = html;
				
				// Generate TOC from headings
				generateTOC();
				
				// Re-render MathJax
				MathJax.typesetPromise();
			})
			.catch(err => {
				contentEl.innerHTML = `<p>Error: ${err.message}</p>`;
			});
		
		function generateTOC() {
			const headings = contentEl.querySelectorAll("h1, h2, h3");
			
			headings.forEach((h, i) => {
				const id = `section-${i}`;
				h.id = id;
				
				const li = document.createElement("li");
				const a = document.createElement("a");
				a.href = `#${id}`;
				a.textContent = h.textContent;
				
				li.appendChild(a);
				tocEl.appendChild(li);
			});
		}
	</script>
</body>

</html>